% 2D_3ions


mp=1.67e-27;
m=40*mp;
Q=1.6e-19;
epsilon=8.854e-12;
kq=Q^2/(4*pi*epsilon);
w1=2*pi*5e6;
w2=2*pi*0.2e6;
k1=m*w1^2;
k2=m*w2^2;

tau=1e-10;
N=1e5;
T=tau*N;
l=(5*Q*Q/(16*m*w2^2*pi*epsilon))^(1/3);


r10=[0,l];
r20=[0,-l];
r30=[0,0];
v10=[80,-30];
v20=[0,0];
v30=[0,0];

r=zeros(N,3,2);
v=zeros(N,3,2);
t=zeros(1,N);
d12=zeros(1,N);
d23=zeros(1,N);
d31=zeros(1,N);
E=zeros(1,N);
a=zeros(1,3,2);

r(1,1,:)=r10;
r(1,2,:)=r20;
r(1,3,:)=r30;
v(1,1,:)=v10;
v(1,2,:)=v20;
v(1,3,:)=v30;
d12(1)=sqrt((r(1,1,1)-r(1,2,1))^2+(r(1,1,2)-r(1,2,2))^2);
d23(1)=sqrt((r(1,2,1)-r(1,3,1))^2+(r(1,2,2)-r(1,3,2))^2);
d31(1)=sqrt((r(1,1,1)-r(1,3,1))^2+(r(1,1,2)-r(1,3,2))^2);
    


E(1)=m/2*(v(1,1,1)^2+v(1,1,2)^2+v(1,2,1)^2+v(1,2,2)^2+v(1,3,1)^2+v(1,3,2)^2)+...
    k1/2*(r(1,1,1)^2+r(1,2,1)^2+r(1,3,1)^2)+k2/2*(r(1,1,2)^2+r(1,2,2)^2+r(1,3,2)^2)+...
    kq*(1/d12(1)+1/d23(1)+1/d31(1));

for i=2:N
    t(i)=t(i-1)+tau;
    d12(i)=sqrt((r(i-1,1,1)-r(i-1,2,1))^2+(r(i-1,1,2)-r(i-1,2,2))^2);
    d23(i)=sqrt((r(i-1,2,1)-r(i-1,3,1))^2+(r(i-1,2,2)-r(i-1,3,2))^2);
    d31(i)=sqrt((r(i-1,1,1)-r(i-1,3,1))^2+(r(i-1,1,2)-r(i-1,3,2))^2);
    a(1,1,1)=-k1/m*r(i-1,1,1)+kq/m*((r(i-1,1,1)-r(i-1,2,1))/(d12(i))^3+(r(i-1,1,1)-r(i-1,3,1))/(d31(i))^3);
    a(1,1,2)=-k2/m*r(i-1,1,2)+kq/m*((r(i-1,1,2)-r(i-1,2,2))/(d12(i))^3+(r(i-1,1,2)-r(i-1,3,2))/(d31(i))^3);
    a(1,2,1)=-k1/m*r(i-1,2,1)+kq/m*((r(i-1,2,1)-r(i-1,1,1))/(d12(i))^3+(r(i-1,2,1)-r(i-1,3,1))/(d23(i))^3);
    a(1,2,2)=-k2/m*r(i-1,2,2)+kq/m*((r(i-1,2,2)-r(i-1,1,2))/(d12(i))^3+(r(i-1,2,2)-r(i-1,3,2))/(d23(i))^3);
    a(1,3,1)=-k1/m*r(i-1,3,1)+kq/m*((r(i-1,3,1)-r(i-1,2,1))/(d23(i))^3+(r(i-1,3,1)-r(i-1,1,1))/(d31(i))^3);
    a(1,3,2)=-k2/m*r(i-1,3,2)+kq/m*((r(i-1,3,2)-r(i-1,2,2))/(d23(i))^3+(r(i-1,3,2)-r(i-1,1,2))/(d31(i))^3);
    v(i,:,:)=v(i-1,:,:)+tau*a;
    r(i,:,:)=r(i-1,:,:)+(v(i,:,:)+v(i-1,:,:))*tau/2;
    E(i)=m/2*(v(i,1,1)^2+v(i,1,2)^2+v(i,2,1)^2+v(i,2,2)^2+v(i,3,1)^2+v(i,3,2)^2)+...
    k1/2*(r(i,1,1)^2+r(i,2,1)^2+r(i,3,1)^2)+k2/2*(r(i,1,2)^2+r(i,2,2)^2+r(i,3,2)^2)+...
    kq*(1/d12(i)+1/d23(i)+1/d31(i));

end



%.plot(t,v[:,0,0])
%.plot(t,v[:,0,1])
%.show()

plot(t,r(:,1,2));
hold on
plot(t,r(:,2,2));
plot(t,r(:,3,2));
hold off

%.plot(t,r[:,0,0])
%.plot(t,r[:,1,0])
%.plot(t,r[:,2,0])
%.show()

plot(r(:,1,1),r(:,1,2));
plot(t,E);
%.plot(r[:,1,0],r[:,1,1])
